#include "libs/final"

final tape = { return new {  // TODO: investigate but if we add (args) to tape
    final contents = args;
    front = 0;

    final::def \at(i) {
        return contents[i+this.front];
    }
    final::def \put(i, value) {
        contents[i+this.front] = value; 
        return this;
    }
    final::def \len() {
        ret = len(contents)-this.front;
        if(ret<0)
            return 0;
        return ret;
    }
    final::def ipush(value) {
        push(contents, value); 
        return this;
    }
    final::def ipop() {
        return pop(contents);
    }
    final::def inext() {
        prev = this.front;
        this.front = prev+1;
        if(found as contents[prev])
            return found;
    }
    final::def reset() {
        this.front = 0;
        return this;
    }
}}


x = tape(1,2,3,4);
while(i as x.inext()) {
    print(i);
}
x = x.reset(); 
print("end");

while(i as x.inext()) {
    print(i);
}





adder(x, y) = {
    default bias = 0;
    assert len(args) == 0;
    x |= float;
    y |= float;
    return x + y + bias;
}

print(adder(1, 2 :: bias=1));



A = list();
A = A|back(1);
print(A);


buff = "";
tic = bbvm::time();
while(i in range(100000)) 
    buff = buff+" "+str(i);

toc = bbvm::time();
print(len(buff));
print((toc-tic), "sec");
print(buff[range(20)]);
